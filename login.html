<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ - DroneDelivery</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                    <span class="logo-icon">üöÅ</span>
                    <span class="logo-text">DroneDelivery</span>
                </a>
                <ul class="nav-menu">
                    <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="index.html#about">–û –Ω–∞—Å</a></li>
                    <li><a href="index.html#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
                <a href="register.html" class="btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </div>
    </nav>

    
    <section class="auth-section">
        <div class="container">
            <div class="auth-wrapper">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1 class="auth-title">–í—Ö–æ–¥</h1>
                        <p class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</p>
                    </div>

                    <form id="loginForm" class="auth-form">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" placeholder="your@email.com" required>
                        </div>

                        <div class="form-group">
                            <label for="password">–ü–∞—Ä–æ–ª—å *</label>
                            <input type="password" id="password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                        </div>

                        <div id="errorMessage" class="error-message" style="display: none;"></div>

                        <button type="submit" class="btn-primary btn-large btn-full">–í–æ–π—Ç–∏</button>
                    </form>

                    <div class="auth-footer">
                        <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        const API_URL = 'http://localhost:8000';
        
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch(`${API_URL}/health`);
                if (!response.ok) {
                    console.warn('API —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API:', error);
                const errorMsg = document.getElementById('errorMessage');
                if (errorMsg) {
                    errorMsg.textContent = '‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ ' + API_URL;
                    errorMsg.style.display = 'block';
                    errorMsg.style.background = '#fef3c7';
                    errorMsg.style.color = '#92400e';
                }
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.style.display = 'none';

            const formData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '–í—Ö–æ–¥...';

            try {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤—Ö–æ–¥–∞...', { email: formData.email });
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status, response.statusText);

                let data;
                try {
                    const text = await response.text();
                    console.log('–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', text);
                    data = text ? JSON.parse(text) : {};
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', e);
                    data = { detail: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞' };
                }

                if (response.ok) {
                    localStorage.setItem('access_token', data.access_token);
                    window.location.href = 'profile.html';
                } else {
                    errorMsg.textContent = data.detail || '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                    errorMsg.style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.textContent = '–í–æ–π—Ç–∏';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                
                let errorText = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. ';
                if (error.name === 'AbortError') {
                    errorText += '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. ';
                } else {
                    errorText += error.message + '. ';
                }
                errorText += '–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ ' + API_URL;
                
                errorMsg.textContent = errorText;
                errorMsg.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = '–í–æ–π—Ç–∏';
            }
        });

        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
    </script>
</body>
</html>


