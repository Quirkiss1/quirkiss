<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - DroneDelivery</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <a href="index.html" class="logo" style="text-decoration: none; color: inherit;">
                    <span class="logo-icon">üöÅ</span>
                    <span class="logo-text">DroneDelivery</span>
                </a>
                <ul class="nav-menu">
                    <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="profile.html" id="profileLink" style="display: none;">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                    <li><a href="index.html#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
                <a href="login.html" id="loginLink" class="btn-secondary">–í–æ–π—Ç–∏</a>
                <button id="logoutBtn" class="btn-secondary" style="display: none;">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </nav>

    
    <section class="order-section">
        <div class="container">
            <div class="order-wrapper">
                <div class="order-header">
                    <h1 class="order-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
                    <p class="order-subtitle" id="category-name">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –∫–∞—Ç–∞–ª–æ–≥–µ</p>
                </div>

                <div class="order-content">
                    <div class="order-form-wrapper">
                        <form class="order-form" id="orderForm">
                            <div class="form-section" id="contactSection" style="display: none;">
                                <h3 class="form-section-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                                <p style="color: var(--text-light); margin-bottom: 1rem;">–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</p>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="name">–ò–º—è</label>
                                        <input type="text" id="name" name="name" readonly style="background: #f3f4f6;">
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                        <input type="tel" id="phone" name="phone" readonly style="background: #f3f4f6;">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3 class="form-section-title">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                                <div class="form-group">
                                    <label for="address">–ê–¥—Ä–µ—Å *</label>
                                    <input type="text" id="address" name="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞" required>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="delivery-time">–ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                                        <select id="delivery-time" name="delivery-time">
                                            <option value="asap">–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</option>
                                            <option value="30min">–í —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç</option>
                                            <option value="1hour">–í —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞</option>
                                            <option value="2hours">–í —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                                        <input type="text" id="comment" name="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3 class="form-section-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
                                <div class="form-group">
                                    <label for="order-details">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ *</label>
                                    <textarea id="order-details" name="order-details" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="weight">–í–µ—Å (–∫–≥)</label>
                                    <input type="number" id="weight" name="weight" placeholder="0" min="0" max="5" step="0.1">
                                </div>
                            </div>

                            <div class="order-summary">
                                <div class="summary-row">
                                    <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                                    <span id="summary-category">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                                    <span id="summary-price">–æ—Ç 199 ‚ÇΩ</span>
                                </div>
                                <div class="summary-row summary-total">
                                    <span>–ò—Ç–æ–≥–æ:</span>
                                    <span id="summary-total">–æ—Ç 199 ‚ÇΩ</span>
                                </div>
                            </div>

                            <button type="submit" class="btn-primary btn-large btn-full">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                        </form>
                    </div>

                    <div class="order-info">
                        <div class="info-card">
                            <div class="info-icon">üöÅ</div>
                            <h3 class="info-title">–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h3>
                            <p class="info-text">–î–æ—Å—Ç–∞–≤–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –≤ –ª—é–±—É—é —Ç–æ—á–∫—É –≥–æ—Ä–æ–¥–∞</p>
                        </div>
                        <div class="info-card">
                            <div class="info-icon">üîí</div>
                            <h3 class="info-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                            <p class="info-text">–í—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω—ã. –ì–∞—Ä–∞–Ω—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –≥—Ä—É–∑–∞</p>
                        </div>
                        <div class="info-card">
                            <div class="info-icon">üì±</div>
                            <h3 class="info-title">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ</h3>
                            <p class="info-text">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                        </div>
                        <div class="info-card">
                            <div class="info-icon">üí≥</div>
                            <h3 class="info-title">–û–ø–ª–∞—Ç–∞</h3>
                            <p class="info-text">–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo">
                        <span class="logo-icon">üöÅ</span>
                        <span class="logo-text">DroneDelivery</span>
                    </div>
                    <p class="footer-description">
                        –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –¥—Ä–æ–Ω–∞–º–∏ –ø–æ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ. 
                        –ë—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ, —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ.
                    </p>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">–£—Å–ª—É–≥–∏</h4>
                    <ul class="footer-links">
                        <li><a href="catalog.html">–ï–¥–∞</a></li>
                        <li><a href="catalog.html">–õ–µ–∫–∞—Ä—Å—Ç–≤–∞</a></li>
                        <li><a href="catalog.html">–ü–æ—Å—ã–ª–∫–∏</a></li>
                        <li><a href="catalog.html">–¢–µ—Ö–Ω–∏–∫–∞</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">–ö–æ–º–ø–∞–Ω–∏—è</h4>
                    <ul class="footer-links">
                        <li><a href="index.html#about">–û –Ω–∞—Å</a></li>
                        <li><a href="index.html#how-it-works">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</a></li>
                        <li><a href="index.html#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                        <li><a href="#">–ö–∞—Ä—å–µ—Ä–∞</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 class="footer-title">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h4>
                    <ul class="footer-links">
                        <li><a href="#">–ü–æ–º–æ—â—å</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a></li>
                        <li><a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 DroneDelivery. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <div class="footer-social">
                    <a href="#" class="social-link">üìò</a>
                    <a href="#" class="social-link">üì∑</a>
                    <a href="#" class="social-link">üê¶</a>
                    <a href="#" class="social-link">üíº</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category');
        
        const categoryData = {
            'food': { name: '–ï–¥–∞', price: '–æ—Ç 199 ‚ÇΩ' },
            'medicine': { name: '–õ–µ–∫–∞—Ä—Å—Ç–≤–∞', price: '–æ—Ç 399 ‚ÇΩ' },
            'parcels': { name: '–ü–æ—Å—ã–ª–∫–∏', price: '–æ—Ç 299 ‚ÇΩ' },
            'tech': { name: '–¢–µ—Ö–Ω–∏–∫–∞', price: '–æ—Ç 499 ‚ÇΩ' },
            'gifts': { name: '–ü–æ–¥–∞—Ä–∫–∏', price: '–æ—Ç 599 ‚ÇΩ' },
            'documents': { name: '–î–æ–∫—É–º–µ–Ω—Ç—ã', price: '–æ—Ç 149 ‚ÇΩ' }
        };

        if (category && categoryData[category]) {
            const data = categoryData[category];
            document.getElementById('category-name').textContent = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${data.name}`;
            document.getElementById('summary-category').textContent = data.name;
            document.getElementById('summary-price').textContent = data.price;
            document.getElementById('summary-total').textContent = data.price;
        }

        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        const API_URL = 'http://localhost:8000';
        const token = localStorage.getItem('access_token');

        if (!token) {
            alert('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
            window.location.href = 'login.html';
        } else {
            loadUserData();
            document.getElementById('loginLink').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline-block';
            document.getElementById('profileLink').style.display = 'inline-block';
        }

        async function loadUserData() {
            try {
                const response = await fetch(`${API_URL}/users/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.status === 401) {
                    localStorage.removeItem('access_token');
                    window.location.href = 'login.html';
                    return;
                }

                const user = await response.json();
                
                document.getElementById('name').value = user.full_name || '';
                document.getElementById('phone').value = user.phone || '';
                document.getElementById('contactSection').style.display = 'block';
                
                if (user.default_delivery_address) {
                    const fullAddress = user.default_delivery_city 
                        ? `${user.default_delivery_city}, ${user.default_delivery_address}`
                        : user.default_delivery_address;
                    document.getElementById('address').value = fullAddress;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!token) {
                alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                window.location.href = 'login.html';
                return;
            }

            const category = urlParams.get('category');
            if (!category) {
                alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞');
                return;
            }

            const orderData = {
                category: category,
                description: document.getElementById('order-details').value,
                delivery_address: document.getElementById('address').value,
                delivery_time: document.getElementById('delivery-time').value,
                comment: document.getElementById('comment').value || null,
                weight: document.getElementById('weight').value ? parseFloat(document.getElementById('weight').value) : null
            };

            try {
                const response = await fetch(`${API_URL}/orders/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    const order = await response.json();
                    window.location.href = 'profile.html?tab=orders';
                } else {
                    const data = await response.json();
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: ' + (data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('access_token');
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>


